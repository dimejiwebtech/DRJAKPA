{% extends 'dashboard_base.html' %} 

{% load static %} 

{% block title %}Analytics | dr.Jakpa{% endblock %} {% block content %}
<div class="max-w-full">
  <!-- ── Header ────────────────────────────────────────────── -->
  <div
    class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-6 mb-10"
  >
    <div>
      <h1
        class="text-2xl font-black text-royal uppercase tracking-tighter leading-none"
      >
        Analytics Overview
      </h1>
      <p
        class="text-[11px] font-bold text-slate-400 uppercase tracking-widest mt-2"
      >
        Platform traffic and engagement metrics.
      </p>
    </div>
    <!-- Period Pills -->
    <div
      class="flex items-center gap-1.5 bg-white border border-slate-200 rounded-xl p-1.5 shadow-sm self-start sm:self-auto"
    >
      <button
        data-period="today"
        class="period-pill px-5 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all text-slate-400 hover:text-royal"
      >
        Today
      </button>
      <button
        data-period="week"
        class="period-pill px-5 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all text-slate-400 hover:text-royal"
      >
        Week
      </button>
      <button
        data-period="month"
        class="period-pill px-5 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all text-slate-400 hover:text-royal"
      >
        Month
      </button>
      <button
        data-period="year"
        class="period-pill px-5 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all text-slate-400 hover:text-royal"
      >
        Year
      </button>
    </div>
  </div>

  <!-- ── Stat Cards ─────────────────────────────────────────── -->
  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
    <!-- Views -->
    <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm">
      <div class="flex items-center gap-2 mb-3">
        <i data-lucide="eye" class="text-slate-300 w-4 h-4"></i>
        <span
          class="text-[10px] font-black text-slate-400 uppercase tracking-widest"
          >Views</span
        >
      </div>
      <div
        class="text-2xl sm:text-3xl font-black text-royal tracking-tighter stat-loader"
        id="stat-views"
      >
        —
      </div>
      <div
        class="text-[10px] font-black text-slate-400 mt-2 uppercase tracking-widest"
        id="stat-period-label"
      >
        This Week
      </div>
    </div>
    <!-- Unique Visitors -->
    <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm">
      <div class="flex items-center gap-2 mb-3">
        <i data-lucide="users" class="text-slate-300 w-4 h-4"></i>
        <span
          class="text-[10px] font-black text-slate-400 uppercase tracking-widest"
          >Visitors</span
        >
      </div>
      <div
        class="text-2xl sm:text-3xl font-black text-royal tracking-tighter stat-loader"
        id="stat-visitors"
      >
        —
      </div>
      <div
        class="text-[10px] font-black text-slate-400 mt-2 uppercase tracking-widest"
      >
        Unique IPs
      </div>
    </div>
    <!-- Top Source -->
    <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm">
      <div class="flex items-center gap-2 mb-3">
        <i data-lucide="arrow-up-right" class="text-slate-300 w-4 h-4"></i>
        <span
          class="text-[10px] font-black text-slate-400 uppercase tracking-widest"
          >Top Source</span
        >
      </div>
      <div
        class="text-lg font-black text-royal tracking-tight stat-loader capitalize"
        id="stat-top-source"
      >
        —
      </div>
      <div
        class="text-[10px] font-black text-slate-400 mt-2 uppercase tracking-widest"
      >
        Primary channel
      </div>
    </div>
    <!-- Top Page -->
    <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm">
      <div class="flex items-center gap-2 mb-3">
        <i data-lucide="file-text" class="text-slate-300 w-4 h-4"></i>
        <span
          class="text-[10px] font-black text-slate-400 uppercase tracking-widest"
          >Top Page</span
        >
      </div>
      <div
        class="text-sm font-black text-royal tracking-tight stat-loader truncate"
        id="stat-top-page"
      >
        —
      </div>
      <div
        class="text-[10px] font-black text-slate-400 mt-2 uppercase tracking-widest truncate"
        id="stat-top-page-url"
      ></div>
    </div>
  </div>

  <!-- ── Main Chart ─────────────────────────────────────────── -->
  <div
    class="bg-white rounded-2xl shadow-sm border border-slate-200 mb-8 overflow-hidden"
  >
    <div
      class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
    >
      <div class="flex items-center gap-3">
        <div class="w-6 h-6 bg-royal rounded flex items-center justify-center">
          <i data-lucide="bar-chart-3" class="w-3.5 h-3.5 text-white"></i>
        </div>
        <h3 class="text-[11px] font-black text-royal uppercase tracking-widest">
          Traffic
        </h3>
        <span
          class="text-[10px] font-bold text-slate-400 uppercase tracking-widest"
          id="chart-period-label"
          >— This Week</span
        >
      </div>
      <div
        class="flex items-center gap-2 p-1 bg-white border border-slate-200 rounded-lg"
      >
        <label
          class="flex items-center cursor-pointer group gap-2 px-3 py-1.5 rounded-md hover:bg-slate-50 transition-colors"
        >
          <span class="w-2.5 h-2.5 rounded-full bg-royal shrink-0"></span>
          <input type="checkbox" id="views-toggle" checked class="sr-only" />
          <span
            class="text-[10px] font-bold text-slate-500 group-hover:text-royal uppercase tracking-widest transition-colors select-none"
            >Views</span
          >
        </label>
        <div class="w-px h-4 bg-slate-200"></div>
        <label
          class="flex items-center cursor-pointer group gap-2 px-3 py-1.5 rounded-md hover:bg-slate-50 transition-colors"
        >
          <span class="w-2.5 h-2.5 rounded-full bg-accent shrink-0"></span>
          <input type="checkbox" id="visitors-toggle" checked class="sr-only" />
          <span
            class="text-[10px] font-bold text-slate-500 group-hover:text-accent uppercase tracking-widest transition-colors select-none"
            >Visitors</span
          >
        </label>
      </div>
    </div>
    <div class="p-6 sm:p-10">
      <!-- Loading skeleton -->
      <div
        id="chart-loader"
        class="w-full h-64 sm:h-80 flex items-center justify-center"
      >
        <div class="flex flex-col items-center gap-3">
          <div
            class="w-8 h-8 border-2 border-royal border-t-transparent rounded-full animate-spin"
          ></div>
          <span
            class="text-[10px] font-black text-slate-300 uppercase tracking-widest"
            >Loading…</span
          >
        </div>
      </div>
      <div class="w-full h-64 sm:h-80 hidden" id="chart-wrap">
        <canvas id="main-chart"></canvas>
      </div>
    </div>
  </div>

  <!-- ── Bottom Panels ──────────────────────────────────────── -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">
    <!-- Most Viewed -->
    <div
      class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden"
    >
      <div
        class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <i data-lucide="trending-up" class="w-3.5 h-3.5 text-slate-300"></i>
          <h3
            class="text-[11px] font-black text-royal uppercase tracking-widest"
          >
            Most Viewed
          </h3>
        </div>
        <span
          class="px-3 py-1.5 bg-accent/10 text-accent rounded-lg text-[9px] font-black uppercase tracking-widest"
          >Posts &amp; pages</span
        >
      </div>
      <div class="p-6">
        <div id="most-viewed-list" class="space-y-2">
          <div
            class="analytics-skeleton h-8 bg-slate-50 rounded-xl animate-pulse"
          ></div>
          <div
            class="analytics-skeleton h-8 bg-slate-50 rounded-xl animate-pulse"
          ></div>
          <div
            class="analytics-skeleton h-8 bg-slate-50 rounded-xl animate-pulse"
          ></div>
        </div>
      </div>
    </div>

    <!-- Traffic Sources -->
    <div
      class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden"
    >
      <div
        class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex items-center gap-2"
      >
        <i data-lucide="share-2" class="w-3.5 h-3.5 text-slate-300"></i>
        <h3 class="text-[11px] font-black text-royal uppercase tracking-widest">
          Traffic Sources
        </h3>
      </div>
      <div class="p-6">
        <!-- Source summary bars -->
        <div id="source-bars" class="space-y-3 mb-5">
          <div
            class="analytics-skeleton h-7 bg-slate-50 rounded-xl animate-pulse"
          ></div>
          <div
            class="analytics-skeleton h-7 bg-slate-50 rounded-xl animate-pulse"
          ></div>
          <div
            class="analytics-skeleton h-7 bg-slate-50 rounded-xl animate-pulse"
          ></div>
        </div>
        <!-- Source detail drill-down -->
        <select
          id="traffic-source-dropdown"
          class="w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-[11px] font-bold text-royal uppercase outline-none focus:border-royal transition-all"
        >
          <option value="">Drill into a source…</option>
          <option value="search">Search Engines</option>
          <option value="social">Social Media</option>
          <option value="referral">Referral Sites</option>
          <option value="direct">Direct Traffic</option>
        </select>
        <div id="source-details" class="mt-4 space-y-2">
          <div
            class="text-[10px] font-bold text-slate-400 uppercase tracking-widest text-center py-6 italic"
          >
            Select a source to drill in
          </div>
        </div>
      </div>
    </div>

    <!-- Locations -->
    <div
      class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden"
    >
      <div
        class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex items-center gap-2"
      >
        <i data-lucide="globe" class="w-3.5 h-3.5 text-slate-300"></i>
        <h3 class="text-[11px] font-black text-royal uppercase tracking-widest">
          Locations
        </h3>
      </div>
      <div class="p-6">
        <!-- Tab switcher -->
        <div class="flex p-1 bg-slate-100 rounded-xl mb-5">
          <button
            class="flex-1 px-4 py-2 text-[10px] font-black uppercase tracking-widest bg-white text-royal rounded-lg shadow-sm transition-all"
            data-tab="countries"
          >
            Countries
          </button>
          <button
            class="flex-1 px-4 py-2 text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-royal transition-all"
            data-tab="regions"
          >
            Regions
          </button>
        </div>
        <!-- Map placeholder -->
        <div
          class="bg-gradient-to-br from-blue-50 to-indigo-50 h-40 rounded-2xl border border-slate-100 flex items-center justify-center mb-5 overflow-hidden"
        >
          <div
            id="locations-map"
            class="w-full h-full flex items-center justify-center"
          >
            <div class="text-center">
              <div
                class="w-12 h-12 bg-royal rounded-full mx-auto mb-3 flex items-center justify-center shadow-lg shadow-royal/20"
              >
                <i data-lucide="map-pin" class="text-white w-5 h-5"></i>
              </div>
              <div
                class="text-[9px] font-black text-royal uppercase tracking-widest"
              >
                Global Visitors
              </div>
            </div>
          </div>
        </div>
        <div id="location-data" class="space-y-2">
          <div
            class="analytics-skeleton h-7 bg-slate-50 rounded-xl animate-pulse"
          ></div>
          <div
            class="analytics-skeleton h-7 bg-slate-50 rounded-xl animate-pulse"
          ></div>
          <div
            class="analytics-skeleton h-7 bg-slate-50 rounded-xl animate-pulse"
          ></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/traffic_stats.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();
  });
</script>
{% endblock %}
